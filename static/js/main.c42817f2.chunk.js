(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{103:function(e,t){},105:function(e,t){},138:function(e,t){},139:function(e,t){},186:function(e,t,n){"use strict";n.r(t);var a=n(3),r=n.n(a),i=n(88),c=n.n(i),o=(n(95),n(7)),s=n.n(o),u=n(13),l=n(18),d=n(19),m=n(21),p=n(20),h=n(22),f=(n(50),n(4)),v=function(e){function t(e){var n;return Object(l.a)(this,t),(n=Object(m.a)(this,Object(p.a)(t).call(this))).webcamElement=e,n}return Object(h.a)(t,e),Object(d.a)(t,[{key:"capture",value:function(){var e=this;return f.k(function(){var t=f.a(e.webcamElement),n=e.cropImage(t),a=n.expandDims(0);return t.dispose(),n.dispose(),a.toFloat().div(f.h(127)).sub(f.h(1))})}},{key:"cropImage",value:function(e){var t=Math.min(e.shape[0],e.shape[1]),n=e.shape[0]/2-t/2,a=e.shape[1]/2-t/2;return e.slice([n,a,0],[t,t,3])}},{key:"adjustVideoSize",value:function(e,t){var n=e/t;e>=t?this.webcamElement.width=n*this.webcamElement.height:e<t&&(this.webcamElement.height=this.webcamElement.width/n)}},{key:"setup",value:function(){var e=Object(u.a)(s.a.mark(function e(){var t=this;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(e,n){var a=navigator;navigator.getUserMedia=navigator.getUserMedia||a.webkitGetUserMedia||a.mozGetUserMedia||a.msGetUserMedia,navigator.getUserMedia?navigator.getUserMedia({video:!0},function(n){t.webcamElement.srcObject=n,t.webcamElement.addEventListener("loadeddata",Object(u.a)(s.a.mark(function n(){return s.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:t.adjustVideoSize(t.webcamElement.videoWidth,t.webcamElement.videoHeight),e();case 2:case"end":return n.stop()}},n,this)})),!1)},function(e){n()}):n()}));case 1:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()}]),t}(a.Component),b=function(e){function t(e){var n;return Object(l.a)(this,t),(n=Object(m.a)(this,Object(p.a)(t).call(this))).numClasses=e,n}return Object(h.a)(t,e),Object(d.a)(t,[{key:"addExample",value:function(e,t){var n=this,a=f.k(function(){return f.g(f.j([t],"int32"),n.numClasses)});if(console.log("label:",t),null==this.xs)this.xs=f.b(e),this.ys=f.b(a);else{var r=this.xs;this.xs=f.b(r.concat(e,0));var i=this.ys;this.ys=f.b(i.concat(a,0)),r.dispose(),i.dispose(),a.dispose();var c=document.getElementById("Div1");null!==c&&c.parentNode.removeChild(c);var o=document.createElement("div");o.setAttribute("id","Div1"),document.body.appendChild(o),o.style.marginBottom="10px";var s=document.createElement("span");s.innerText="EXAMPLE #  ".concat(this.ys.shape[0]," ADDED"),o.appendChild(s)}}}]),t}(a.Component),E=n(89),w=n.n(E),g=function(e){return r.a.createElement("div",null,r.a.createElement("div",{className:"App",onLoad:e.main},r.a.createElement("header",{className:"App-header"},r.a.createElement("img",{src:w.a,className:"App-logo",alt:"logo"}),r.a.createElement("h4",{className:"App-title"},"Webcam classifier with Tensorflow.js and REACT"))),r.a.createElement("div",{id:"message"},r.a.createElement("p",null,"To capture images for every class, press CLASS 0-2 respectively. Afterwars press TRAIN, and finally PREDICT.")),r.a.createElement("div",{id:"webcam-wrapper"},r.a.createElement("video",{id:"webcam",width:"224",height:"224",controls:!0,autoPlay:!0}),r.a.createElement("br",null),r.a.createElement("br",null),r.a.createElement("button",{id:"1"}," Class 0 "),r.a.createElement("button",{id:"2"}," Class 1 "),r.a.createElement("button",{id:"3"}," Class 2 "),r.a.createElement("br",null),r.a.createElement("br",null)," ",r.a.createElement("button",{id:"train"}," TRAIN "),r.a.createElement("button",{id:"predict"}," PREDICT "),r.a.createElement("button",{id:"reset"}," RESET ")),r.a.createElement("br",null))},y=function(e){function t(){var e,n;Object(l.a)(this,t);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return(n=Object(m.a)(this,(e=Object(p.a)(t)).call.apply(e,[this].concat(r)))).state={predd:[]},n.main=function(){var e,t,n=3,a=new v(document.getElementById("webcam")),r=new b(n);function i(){return c.apply(this,arguments)}function c(){return(c=Object(u.a)(s.a.mark(function e(){var t,n;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,f.d("https://storage.googleapis.com/tfjs-models/tfjs/mobilenet_v1_0.25_224/model.json");case 2:return t=e.sent,n=t.getLayer("conv_pw_13_relu"),e.abrupt("return",f.e({inputs:t.inputs,outputs:n.output}));case 5:case"end":return e.stop()}},e,this)}))).apply(this,arguments)}function o(){return(o=Object(u.a)(s.a.mark(function t(){var n,c,o,u;return s.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return u=function(t){f.k(function(){var n=a.capture();r.addExample(e.predict(n),t)})},t.next=3,a.setup();case 3:return t.next=5,i();case 5:e=t.sent,f.k(function(){return e.predict(a.capture())}),a.capture(),(n=document.getElementById("1")).addEventListener("mousedown",function(){return u(0)}),n.addEventListener("mouseup",function(){return u(0)}),(c=document.getElementById("2")).addEventListener("mousedown",function(){return u(1)}),c.addEventListener("mouseup",function(){return u(1)}),(o=document.getElementById("3")).addEventListener("mousedown",function(){return u(2)}),o.addEventListener("mouseup",function(){return u(2)});case 17:case"end":return t.stop()}},t,this)}))).apply(this,arguments)}function l(){return(l=Object(u.a)(s.a.mark(function e(){var a,i;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("TRAINN"),null!=r.xs){e.next=4;break}throw alert("Add some examples before training!"),new Error("Add some examples before training!");case 4:if(t=f.i({layers:[f.c.flatten({inputShape:[7,7,256]}),f.c.dense({units:100,activation:"relu",kernelInitializer:"varianceScaling",useBias:!0}),f.c.dense({units:n,kernelInitializer:"varianceScaling",useBias:!1,activation:"softmax"})]}),a=f.l.adam(1e-4),t.compile({optimizer:a,loss:"categoricalCrossentropy"}),(i=Math.floor(.4*r.xs.shape[0]))>0){e.next=10;break}throw new Error("Batch size is 0 or NaN. Please choose a non-zero fraction.");case 10:t.fit(r.xs,r.ys,{batchSize:i,epochs:20,callbacks:{onBatchEnd:function(){var e=Object(u.a)(s.a.mark(function e(t,n){var a,r,i;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("Loss: "+n.loss.toFixed(10)),null!==(a=document.getElementById("Div1"))&&a.parentNode.removeChild(a),(r=document.createElement("div")).setAttribute("id","Div1"),document.body.appendChild(r),r.style.marginBottom="10px",(i=document.createElement("span")).innerText="LOSS: ".concat(n.loss.toFixed(5)),r.appendChild(i),e.next=12,f.f();case 12:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()}});case 11:case"end":return e.stop()}},e,this)}))).apply(this,arguments)}function d(){return(d=Object(u.a)(s.a.mark(function n(){var r,i,c,o,u,l;return s.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return r=f.k(function(){var n=a.capture(),r=e.predict(n);return t.predict(r).as1D()}),n.next=4,r.argMax().data();case 4:return i=n.sent[0],n.next=7,r.dataSync()[i];case 7:return c=n.sent,console.log("classId:",i),console.log("prob:",c),null!==(o=document.getElementById("Div1"))&&o.parentNode.removeChild(o),(u=document.createElement("div")).setAttribute("id","Div1"),document.body.appendChild(u),u.style.marginBottom="10px",(l=document.createElement("span")).innerText="THE PREDICTED CLASS: ".concat(i," with prob. ").concat((100*c).toFixed(0),"%"),u.appendChild(l),n.next=21,f.f();case 21:n.next=0;break;case 23:case"end":return n.stop()}},n,this)}))).apply(this,arguments)}!function(){o.apply(this,arguments)}(),document.getElementById("train").addEventListener("click",function(){return function(){return l.apply(this,arguments)}()}),document.getElementById("predict").addEventListener("click",function(){return function(){return d.apply(this,arguments)}()}),document.getElementById("reset").addEventListener("click",function(){window.location.reload()})},n}return Object(h.a)(t,e),Object(d.a)(t,[{key:"render",value:function(){return r.a.createElement(g,{main:this.main,reset:this.reset})}}]),t}(a.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));c.a.render(r.a.createElement(y,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})},50:function(e,t,n){},89:function(e,t,n){e.exports=n.p+"static/media/logo.5d5d9eef.svg"},90:function(e,t,n){e.exports=n(186)},95:function(e,t,n){}},[[90,2,1]]]);
//# sourceMappingURL=main.c42817f2.chunk.js.map